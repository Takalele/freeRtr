Procedure ReadUpConfig(a:String);
Var t:xtText;

function gnl:string;
var
  i:longint;
  a:String;
begin;
a:=xtReadLn(t,255);
i:=pos(';',a);
if (i>0) then a:=copy(a,1,i-1);
a:=' '+a+' ';
kicserel('  ',' ',a);
a:=copy(a,2,length(a)-2);
gnl:=a;
end;

Var
  d:OneConnectionRecord;
  b:String;
  i,o,p:LongInt;
Begin;
if (xtOpen(t,a,true)<>0) then immErr('error opening config!');
serverPort:=BVal(gnl);
remotePort:=BVal(gnl);
packetSize:=BVal(gnl);
if string2ipAddr(gnl,remoteAddr) then immErr('bad peer address!');
ConnectionNum:=0;
GroupNumber:=0;
ResizeMem(0);
fillchar(d,sizeof(d),0);
while not xtEOF(t) do begin;
  a:=gnl;
  if (a='') then continue;
  i:=pos('-',a);
  if (i<1) then begin;
    i:=BVal(a);
    o:=i;
    end else begin;
    o:=BVal(copy(a,i+1,666));
    i:=BVal(copy(a,1,i-1));
    end;
  if (o<i) then immErr('bad channel pair!');
  if (i<1) then immErr('bad lower channel!');
  d.min:=i;
  d.max:=o;
  d.lst:=$7e;
  inc(GroupNumber);
  if ResizeMem(GroupNumber) then immErr('error allocating memory!');
  ConnectionDat^[GroupNumber]:=d;
  end;
xtClose(t);
p:=0;
for i:=1 to GroupNumber do begin;
  o:=ConnectionDat^[i].max;
  if (p<o) then p:=o;
  end;
if ResizeMem(o) then immErr('error allocating memory!');
d.min:=0;
d.max:=0;
for i:=GroupNumber+1 to ConnectionNum do ConnectionDat^[i]:=d;
fillchar(bytes2buffer,sizeof(bytes2buffer),0);
for o:=1 to GroupNumber do
 for i:=ConnectionDat^[o].min to ConnectionDat^[o].max do bytes2buffer[i]:=o;
End;
