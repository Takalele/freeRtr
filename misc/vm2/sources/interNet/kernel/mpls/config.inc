Procedure ReadUpConfig(a:String);
Var t:xtText;

function gnl:string;
var
  i:longint;
  a:String;
begin;
a:=xtReadLn(t,255);
i:=pos(';',a);
if (i>0) then a:=copy(a,1,i-1);
a:=' '+a+' ';
kicserel('  ',' ',a);
a:=copy(a,2,length(a)-2);
gnl:=a;
end;

function gnw(var b:String):string;
var
  bb:array[0..1] of byte absolute b;
  bb0:byte absolute b;
  a:string;
  ab:array[0..1] of byte absolute a;
  ab0:byte absolute a;
  i:longint;
begin;
ab0:=0;
while (bb0>0) do begin;
  if (bb[1]=32) then break;
  inc(ab0);
  ab[ab0]:=bb[1];
  b:=copy(b,2,666);
  end;
b:=copy(b,2,666);
gnw:=a;
end;

Var
  con:OneConnectionRecord;
  ses:OneSessionRecord;
  b:String;
  i,o:LongInt;
Begin;
WriteLn('reading '+a+'...');
if (xtOpen(t,a,true)<>0) then immErr('error opening!');
lowerName:=gnl;
upperName:=gnl;
localPort:=BVal(gnl);
string2ipAddr(gnl,b);
firstHopI:=convert2ip4addr(b);
b:=gnl;
kicserel('.','',b);
kicserel('-','',b);
for i:=1 to sizeof(virtMacAd) do virtMacAd[i]:=BVal('$'+copy(b,i*2-1,2));
ConnectionNum:=1;
SessionNum:=0;
fillchar(con,sizeof(con),0);
con.addr:=firstHopI;
con.conn:=1;
ConnectionDat[1]:=con;
while not xtEOF(t) do begin;
  b:=gnl;
  if (b='') then continue;
  fillchar(con,sizeof(con),0);
  fillchar(ses,sizeof(ses),0);
  if string2ipAddr(gnw(b),a) then continue;
  ses.addr:=convert2ip4addr(a);
  a:=kicsi(gnw(b));
  i:=0;
  if (a='eth') then i:=5;
  if (a='vlan') then i:=4;
  if (a='hdlc') then i:=6;
  if (a='ppp') then i:=7;
  if (a='ip') then i:=11;
  if (i<1) then continue;
  ses.mode:=i;
  ses.vcid:=BVal(gnw(b));
  ses.mttu:=BVal(gnw(b));
  ses.conn:=findOnePeerAddr(ses.addr);
  if (ses.conn<1) then begin;
    inc(ConnectionNum);
    con.addr:=ses.addr;
    con.conn:=ConnectionNum;
    ConnectionDat[ConnectionNum]:=con;
    ses.conn:=ConnectionNum;
    end;
  inc(SessionNum);
  ses.sess:=SessionNum;
  SessionDat[SessionNum]:=ses;
  end;
xtClose(t);
End;
