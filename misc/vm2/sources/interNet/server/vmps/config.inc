Procedure ReadUpConfig(a:String);
Var t:xtText;

function gnl:string;
var
  i:longint;
  a:String;
begin;
a:=xtReadLn(t,255);
i:=pos(';',a);
if (i>0) then a:=copy(a,1,i-1);
a:=' '+a+' ';
kicserel('  ',' ',a);
a:=copy(a,2,length(a)-2);
gnl:=a;
end;

Label f1;
Var
  d:OneConnectionRecord;
  b,c:String;
  i,o:LongInt;
Begin;
if (xtOpen(t,a,true)<>0) then immErr('error opening config!');
portCmd:=BVal(gnl);
ResizeMem(0);
fillchar(ConnectionDef,sizeof(ConnectionDef),0);
ConnectionDef.lan:=#13;
while not xtEOF(t) do begin;
  b:=gnl;
  if (b='') then continue;
  c:=kicsi(getWord(b));
  a:=kicsi(getWord(b));
  fillchar(d,sizeof(d),0);
  if (a='deny') then begin;
    d.lan:=#13;
    goto f1;
    end;
  if (a='shutdown') then begin;
    d.lan:=#10;
    goto f1;
    end;
  if (a='allow') then begin;
    d.lan:=b;
    goto f1;
    end;
  continue;
  f1:
  if (c='default') then begin;
    ConnectionDef:=d;
    continue;
    end;
  for i:=1 to 6 do begin;
    d.adr[i]:=hextype2byte(copy(c,1,2));
    c:=copy(c,3,666);
    end;
  if ResizeMem(ConnectionNum+1) then immErr('error allocating memory!');
  ConnectionDat^[ConnectionNum]:=d;
  end;
xtClose(t);
End;
