Procedure ReadUpConfig(a:String);
Var t:xtText;

function gnl:string;
var
  i:longint;
  a:String;
begin;
a:=xtReadLn(t,255);
i:=pos(';',a);
if (i>0) then a:=copy(a,1,i-1);
a:=' '+a+' ';
kicserel('  ',' ',a);
a:=copy(a,2,length(a)-2);
gnl:=a;
end;

Label f1;
Var
  ad:OneTCPaddressRecord;
  d:OneConnectionRecord;
  b,c:String;
  i,o:LongInt;
Begin;
if (xtOpen(t,a,true)<>0) then immErr('error opening config!');
portCmd:=BVal(gnl);
lowLevelProc:=BugOS_findProcNam(gnl);
if (lowLevelProc=0) then immErr('low level process not found!');
if string2ipAddr(gnl,gateAddr) then immErr('error in gateway address!');
if string2ipAddr(gnl,maskAddr) then immErr('error in netmask address!');
b:=gnl;
i:=0;
while (b<>'') do begin;
  a:=getWord(b);
  if string2ipAddr(a,ad) then immErr('error in dns addresses!');
  move(ad[ip4addrBegin],dnsLists[i+1],4);
  inc(i,4);
  end;
dnsLists[0]:=chr(i);
domainNam:=gnl;
bootServ:=gnl;
bootFile:=gnl;
leaseTime:=BVal(gnl);

ConnectionNum:=0;
f1:
if xtEOF(t) then begin;
  xtClose(t);
  exit;
  end;
b:=gnl;
if (b='') then goto f1;
c:=b;
fillchar(d,sizeof(d),0);
a:=getWord(b);
if string2ipAddr(a,ad) then immErr('error in line: '+c);
move(ad[ip4addrBegin],d.ipA,sizeof(d.ipA));
if (FindOneInternetAddr(d.ipA)<>0) then goto f1;
a:=getWord(b);
if (a<>'!') then begin;
  for i:=1 to BVal(a) do begin;
    if ResizeMem(ConnectionNum+1) then immErr('error allocating memory!');
    ConnectionDat^[ConnectionNum]:=d;
    WriteLongMSB(d.ipA,ReadLongMSB(d.ipA)+1);
    end;
  goto f1;
  end;
kicserel(' ','',b);
kicserel(':','',b);
kicserel('-','',b);
o:=0;
while (b<>'') do begin;
  inc(o);
  d.hwA[o]:=BVal('$'+copy(b,1,2));
  b:=copy(b,3,255);
  end;
if ResizeMem(ConnectionNum+1) then immErr('error allocating memory!');
d.typ:=2;
ConnectionDat^[ConnectionNum]:=d;
goto f1;
End;
