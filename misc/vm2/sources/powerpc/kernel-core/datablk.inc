;------------------------------- kernel info...
kernel_id1:
db 'name: BugOS Kernel',13,10
db 'version: 2.0',13,10
db 'date: ',%date,13,10
db 'time: ',%time,13,10
db 'coder: Mc',13,10
db 0
;------------------------------- kernel logo...
kernel_id2:
db 'ßÛÛßßÛÜ   Coded by Mc   ÜÛßßßÛÜ ÜÛßßßÛÜ',13,10
db ' ÛÛ  ÛÛ ÜÜ  ÜÜ   ÜÜÜ ÜÜ ÛÛ   ÛÛ ßÛÜ  ßß',13,10
db ' ÛÛßßÛÜ ÛÛ  ÛÛ  ÛÛ  ÛÛ  ÛÛ   ÛÛ   ßßÛÜ',13,10
db ' ÛÛ  ÛÛ ÛÛ  ÛÛ  ÛÛ  ÛÛ  ÛÛ   ÛÛ ÜÜ   ÛÛ',13,10
db 'ÜÛÛÜÜÛß ßÛÜÜßÛÜ ßÛÜÜÛÛ  ßÛÜÜÜÛß ßÛÜÜÜÛß',13,10
db '                ÜÜ  ÛÛ',13,10
db '                 ßßßß      Kernel v2.0',13,10
db 0
;-------------------------------

;------------------------------- general texts...
textCRLF db 13,10,0
text001 db '0123456789ABCDEF',0
text002 db 'error: ',0
text003 db 'unwanted exception!',0
text004 db 'going to reboot...',0
text005 db 'exception: #',0
text006 db ': ',0
text007 db 13,10,'pid=',0
text008 db '  par=',0
text009 db '  uid=',0
text010 db '  rgt=',0
text011 db 13,10,'pathname="',0
text012 db '"',13,10,'parameter="',0
text013 db '"',13,10,0
text014 db '@',driveSeparatorChar,pathSeparatorChar,'startupRamDrive.Code',0
text015 db '@',driveSeparatorChar,pathSeparatorChar,'ramDriveStarter.Code',0
text016 db '@',driveSeparatorChar,pathSeparatorChar,0
;------------------------------- exception names...
textExLst:
dd offset textEx00,offset textEx01,offset textEx02,offset textEx03
dd offset textEx04,offset textEx05,offset textEx06,offset textEx07
dd offset textEx08,offset textEx09,offset textEx10,offset textEx11
dd offset textEx12,offset textEx13,offset textEx14,offset textEx15
dd offset textEx16,offset textEx17,offset textEx18,offset textEx19
dd offset textEx20,offset textEx21,offset textEx22,offset textEx23
dd offset textEx24,offset textEx25,offset textEx26,offset textEx27
dd offset textEx28,offset textEx29,offset textEx30,offset textEx31
textEx10:
textEx11:
textEx15:
textEx21:
textEx22:
textEx23:
textEx24:
textEx25:
textEx26:
textEx27:
textEx00 db 'unknown',0
textEx01 db 'system reset',0
textEx02 db 'machine check',0
textEx03 db 'data storage',0
textEx04 db 'instruction storage',0
textEx05 db 'interrupt',0
textEx06 db 'alignment',0
textEx07 db 'program',0
textEx08 db 'floating point unavailable',0
textEx09 db 'decrementer',0
textEx12 db 'system call',0
textEx13 db 'trace',0
textEx14 db 'floating point assistance',0
textEx16 db 'software emulation',0
textEx17 db 'instruction tlb miss',0
textEx18 db 'data tlb miss',0
textEx19 db 'instruction tlb error',0
textEx20 db 'data tlb error',0
textEx28 db 'data breakpoint',0
textEx29 db 'instruction breakpoint',0
textEx30 db 'peripherial breakpoint',0
textEx31 db 'nonmaskable developer port',0
;------------------------------- register names...
textRg00 db 13,10,'r00=',0
textRg01 db '  r01=',0
textRg02 db '  r02=',0
textRg03 db '  r03=',0
textRg04 db 13,10,'r04=',0
textRg05 db '  r05=',0
textRg06 db '  r06=',0
textRg07 db '  r07=',0
textRg08 db 13,10,'r08=',0
textRg09 db '  r09=',0
textRg10 db '  r10=',0
textRg11 db '  r11=',0
textRg12 db 13,10,'r12=',0
textRg13 db '  r13=',0
textRg14 db '  r14=',0
textRg15 db '  r15=',0
textRg16 db 13,10,'r16=',0
textRg17 db '  r17=',0
textRg18 db '  r18=',0
textRg19 db '  r19=',0
textRg20 db 13,10,'r20=',0
textRg21 db '  r21=',0
textRg22 db '  r22=',0
textRg23 db '  r23=',0
textRg24 db 13,10,'r24=',0
textRg25 db '  r25=',0
textRg26 db '  r26=',0
textRg27 db '  r27=',0
textRg28 db 13,10,'r28=',0
textRg29 db '  r29=',0
textRg30 db '  r30=',0
textRg31 db '  r31=',0
textRgIA db 13,10,'ia=',0
textRgCR db '  cr=',0
textRgXER db '  xer=',0
textRgCTR db '  ctr=',0
textRgLR db 13,10,'lr=',0
;-------------------------------

;------------------------------- init process binary...
align 4
initProcess_beg:
incbin initproc.code
initProcess_end:
align 4
;------------------------------- general constants...
MemoryTestBlock equ 100000h     ;memory test block size...
KernelMapdAddr equ 0c0000000h   ;kernel's mapped address...
KernelProcNum equ 0ffffffffh    ;kernel's process number...
AdminUserNum equ 0              ;administrator's uid...
pathSeparatorChar equ 92        ;the path separator char: '\'...
driveSeparatorChar equ 58       ;the drive separator char: ':'...
;------------------------------- memory constants...
TimerClicksPerSec equ 32        ;ticks per second...
ramDriveMaxSiz equ 200000h      ;ram drive offset from kernel...
irqHookingTable dd 16 dup (0)   ;irq hook table...
driveHookTable dd 512 dup (0)   ;drive hook table...
ProcessorText db 16 dup (0)     ;cpu name and revision...
ProcessorCode dd 0              ;cpu identification...
KernelBigBuf dd 0               ;96k free buffer space...
TotalMemByt dd 0                ;total bytes available...
TotalMemPag dd 0                ;total pages available...
PageTableOfs dd 0               ;mmu paging table...
MemAllocOfs dd 0                ;memory usage table...
FirstPipeOfs dd 0               ;first pipeline offset...
FirstFileOfs dd 0               ;first file offset...
FirstProcOfs dd 0               ;first process offset...
TicksPerOneDay dd 0             ;ticks occuring in one day...
StartupPastTick dd 0            ;ticks past since startup...
StartupPastDays dd 0            ;days past since startup...
CurrProcOfs dd 0                ;current process descriptor...
CurrProcPid dd 0                ;current process id...
NextIdTryGiv dd 0               ;next id to try to give...
NextItlbWrte dd 0               ;next tlb to overwrite...
NextDtlbWrte dd 0               ;next tlb to overwrite...
TotProcStrt dd 0                ;total number of process starts...
TotFrstStrt dd 0                ;total number of first process starts...
ActiveDriveDsk dd 0             ;active drive disk process id...
ActiveDriveUsr dd 0             ;active drive user process id...
ActiveDriveDsc dd 0             ;active drive user descriptor...
ActiveDriveTim dd 0             ;active drive tim started...
ActiveDriveBuf dd 0             ;active drive buffer offset...
ActiveDriveSrc dd 0             ;active drive source offset...
ActiveDriveTrg dd 0             ;active drive target offset...
ActiveDriveSiz dd 0             ;active drive bytes to copy...
ActiveDriveMap dd 0             ;active drive mapping needed...
ActiveDriveHnd dd 0             ;active drive handler number...
ActiveDriveHnO dd 0             ;active drive handler offset...
ActiveDriveCmd dd 0             ;active drive command issued...
ActiveDriveRgt dd 0             ;active drive rights...
;------------------------------- listing layout...
listing_idnt equ 00h            ;dd: id...
listing_next equ 04h            ;dd: next descriptor...
listing_prev equ 08h            ;dd: previous descriptor...
;------------------------------- pipeline list layout...
pipeLst_plid equ 00h            ;dd: pipeline id...
pipeLst_next equ 04h            ;dd: next pipeline descriptor...
pipeLst_prev equ 08h            ;dd: previous pipeline descriptor...
pipeLst_size equ 0ch            ;dw: size of pipeline in bytes...
pipeLst_blck equ 0eh            ;db: block mode pipeline...
pipeLst_begS equ 10h            ;dd: offset of send (c->a) buffer...
pipeLst_begR equ 14h            ;dd: offset of receive (a->c) buffer...
pipeLst_sizS equ 18h            ;dd: size of send (c->a) buffer...
pipeLst_sizR equ 1ch            ;dd: size of receive (a->c) buffer...
pipeLst_posS equ 20h            ;dd: position in send (c->a) buffer...
pipeLst_posR equ 24h            ;dd: position in receive (a->c) buffer...
pipeLst_pidC equ 28h            ;dd: caller's pid...
pipeLst_pidA equ 2ch            ;dd: answerer's pid...
pipeLst__hed equ 30h            ;size of header...
pipeLst__siz equ 8000h          ;size of structure in bytes...
;------------------------------- irq hook entry layout...
irqHook_pid equ 00h             ;dd: process id...
irqHook_ia equ 04h              ;dd: entering pc value...
irqHook__siz equ 08h            ;size of structure...
;------------------------------- drive list layout...
driveLst_pid equ 00h            ;dd: process id...
driveLst_buf equ 04h            ;dd: shared buffer offset...
driveLst__siz equ 08h           ;size of structure...
;------------------------------- drive buffer layout...
drvBuf_cmd equ 000h             ;dd: command/result code...
drvBuf_usr equ 004h             ;dd: user who wants to do...
drvBuf_rgt equ 008h             ;dd: rights what user wants to do...
drvBuf_siz equ 00ch             ;dd: buffer size...
drvBuf_dir equ 010h             ;256: current directory...
drvBuf_fn1 equ 110h             ;256: pathname #1...
drvBuf_fn2 equ 210h             ;256: pathname #2...
drvBuf_hdr equ 310h             ;512: file handle...
drvBuf_dat equ 510h             ;64k: data buffer...
drvBuf__siz equ 10510h          ;size of structure...
;------------------------------- open file list layout...
fileLst_hdr equ 000h            ;dd: file handler...
fileLst_nxt equ 004h            ;dd: next handler offset...
fileLst_prv equ 00ch            ;dd: previous handler offset...
fileLst_pid equ 010h            ;dd: process id...
fileLst_rgt equ 014h            ;dd: access rights...
fileLst_drv equ 018h            ;dd: pid of drive process...
fileLst_ind equ 01ch            ;dd: inode of file...
fileLst_buf equ 020h            ;dd: drive buffer...
fileLst_dat equ 100h            ;512: file data...
fileLst__siz equ 300h           ;size of structure...
;------------------------------- rights...
rights_ownRead equ 01h          ;owner can read...
rights_ownWrite equ 02h         ;owner can write...
rights_ownExec equ 04h          ;owner can execute...
rights_anyRead equ 08h          ;everybody can read...
rights_anyWrite equ 10h         ;everybody can write...
rights_anyExec equ 20h          ;everybody can execute...
rights_rootPriv equ 40h         ;has root privileges (can do tricks;)
rights_directory equ 80h        ;this is a directory...
rights_allowRead equ 100h       ;allow simultaneous read...
rights_allowWrite equ 200h      ;allow simultaneous write...
rights_allowExec equ 400h       ;allow simultaneous execution...
;------------------------------- system drive commands...
sysDrvCmd_chgDir equ 001h       ;change directory...
sysDrvCmd_statst equ 002h       ;drive statistics...
sysDrvCmd_makDir equ 003h       ;create directory...
sysDrvCmd_delDir equ 004h       ;erase directory...
sysDrvCmd_makFil equ 005h       ;create file...
sysDrvCmd_delFil equ 006h       ;erase file...
sysDrvCmd_rename equ 007h       ;rename...
sysDrvCmd_mkLink equ 008h       ;make link...
sysDrvCmd_stRigt equ 009h       ;set rights...
sysDrvCmd_stDate equ 00Ah       ;set date...
sysDrvCmd_drOpen equ 00Bh       ;open directory...
sysDrvCmd_drRead equ 00Ch       ;read directory...
sysDrvCmd_flOpen equ 00Dh       ;open file...
sysDrvCmd_flRead equ 00Eh       ;read file...
sysDrvCmd_flWrte equ 00Fh       ;write file...
sysDrvCmd_flSeek equ 010h       ;seek file...
sysDrvCmd_flSize equ 011h       ;get file size...
sysDrvCmd_flPosi equ 012h       ;get file pos...
sysDrvCmd_flTrnc equ 013h       ;truncate file...
;------------------------------- error codes....
error_none equ 0                ;no error...
error_default equ 1             ;unknown error...
error_memSpace equ 2            ;out of memory...
error_diskSpace equ 3           ;out of disk space...
error_noRight equ 4             ;no right...
error_sharing equ 5             ;sharing violation...
error_noPath equ 6              ;path not exists...
error_notExists equ 7           ;file not exists...
error_already equ 8             ;file already exists...
error_handler equ 9             ;invalid handle...
error_dirNotEmpty equ 10        ;directory not empty...
error_dirEmbedded equ 11        ;embedded directories...
error_dirMismatch equ 12        ;file/directory mismatch...
error_pointerBig equ 13         ;file pointer too big...
error_ioFault equ 14            ;drive io fault...
error_drvNotRedy equ 15         ;drive not ready...
error_endOfFile equ 16          ;eof encountered...
error_badName equ 17            ;invalid filename format...
error_badTermin equ 18          ;abnormal program termination...
;------------------------------- process status...
status_running equ 0            ;up and running...
status_initial equ 1            ;under initialization...
status_fileio equ 2             ;fileio pending...
status_wait4exec equ 3          ;execute pending...
;------------------------------- executable header layout...
execHdr_idntfy equ 00h          ;dd: executable identifier...
execHdr_codSiz equ 04h          ;dd: code size in bytes...
execHdr_datSiz equ 08h          ;dd: data size in bytes...
execHdr_stkSiz equ 0ch          ;dd: stack size in bytes...
execHdr__siz equ 10h            ;size of structure...
execHdr__idv equ 65786563h      ;executable identifier value...
;------------------------------- process stack data layout...
procStk_pid equ 000h            ;dd: process id...
procStk_next equ 004h           ;dd: next process offset...
procStk_prev equ 008h           ;dd: previous process offset...
procStk_ppid equ 00ch           ;dd: parent process id...
procStk_cuid equ 010h           ;dd: current user id...
procStk_ouid equ 014h           ;dd: original user id...
procStk_right equ 018h          ;dd: rights...
procStk_codeSize equ 01ch       ;dd: code size in bytes...
procStk_stakSize equ 020h       ;dd: stack size in bytes...
procStk_dataSize equ 024h       ;dd: data size in bytes...
procStk_pathName equ 028h       ;256: process pathname...
procStk_paramStr equ 128h       ;256: parameter string...
procStk_currDir equ 228h        ;256: current directory...
procStk_lastReleq equ 328h      ;dd: ticks since last control giveaway...
procStk_status equ 32ch         ;db: status of process...
procStk_oldStat equ 32dh        ;db: old status of process...
procStk_rentCon equ 330h        ;dd: console owner process id...
procStk_console equ 334h        ;dd: pipeline of console...
procStk_listen equ 338h         ;dd: pipeline of listening...
procStk_execWait equ 33ch       ;dd: waiting for this pid...
procStk_missdIrq equ 340h       ;dd: number of missed irqs...
procStk_mapdSize equ 344h       ;dd: mapped data size in pages...
procStk_mapVoffs equ 348h       ;dd: mapped data virtual page offset...
procStk_mapPoffs equ 34ch       ;dd: mapped data physical page offset...
procStk_reg_r0 equ 350h         ;dd: r0 register...
procStk_reg_r1 equ 354h         ;dd: r1 register...
procStk_reg_r2 equ 358h         ;dd: r2 register...
procStk_reg_r3 equ 35ch         ;dd: r3 register...
procStk_reg_r4 equ 360h         ;dd: r4 register...
procStk_reg_r5 equ 364h         ;dd: r5 register...
procStk_reg_r6 equ 368h         ;dd: r6 register...
procStk_reg_r7 equ 36ch         ;dd: r7 register...
procStk_reg_r8 equ 370h         ;dd: r8 register...
procStk_reg_r9 equ 374h         ;dd: r9 register...
procStk_reg_r10 equ 378h        ;dd: r10 register...
procStk_reg_r11 equ 37ch        ;dd: r11 register...
procStk_reg_r12 equ 380h        ;dd: r12 register...
procStk_reg_r13 equ 384h        ;dd: r13 register...
procStk_reg_r14 equ 388h        ;dd: r14 register...
procStk_reg_r15 equ 38ch        ;dd: r15 register...
procStk_reg_r16 equ 390h        ;dd: r16 register...
procStk_reg_r17 equ 394h        ;dd: r17 register...
procStk_reg_r18 equ 398h        ;dd: r18 register...
procStk_reg_r19 equ 39ch        ;dd: r19 register...
procStk_reg_r20 equ 3a0h        ;dd: r20 register...
procStk_reg_r21 equ 3a4h        ;dd: r21 register...
procStk_reg_r22 equ 3a8h        ;dd: r22 register...
procStk_reg_r23 equ 3ach        ;dd: r23 register...
procStk_reg_r24 equ 3b0h        ;dd: r24 register...
procStk_reg_r25 equ 3b4h        ;dd: r25 register...
procStk_reg_r26 equ 3b8h        ;dd: r26 register...
procStk_reg_r27 equ 3bch        ;dd: r27 register...
procStk_reg_r28 equ 3c0h        ;dd: r28 register...
procStk_reg_r29 equ 3c4h        ;dd: r29 register...
procStk_reg_r30 equ 3c8h        ;dd: r30 register...
procStk_reg_r31 equ 3cch        ;dd: r31 register...
procStk_reg_ia equ 3d0h         ;dd: ia register...
procStk_reg_cr equ 3d4h         ;dd: cr register...
procStk_reg_lr equ 3d8h         ;dd: lr register...
procStk_reg_ctr equ 3dch        ;dd: ctr register...
procStk_reg_xer equ 3e0h        ;dd: xer register...
procStk_pageSize equ 3e4h       ;dd: pagetable entries available...
procStk_pageDefS equ 3e8h       ;dd: pagetable default size...
procStk_irqRetIa equ 3ech       ;dd: irq return ia value...
procStk_irqRetSp equ 3f0h       ;dd: irq return r31 value...
procStk_timesRun equ 3f4h       ;dd: times process started...
procStk_xcptData equ 3f8h       ;dd: offset of last data exception...
procStk_xcptCode equ 3fch       ;dd: offset of last code exception...
procStk__siz equ 400h           ;size of structure, pagetable follows...
;-------------------------------
