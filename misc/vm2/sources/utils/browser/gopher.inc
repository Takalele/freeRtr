Procedure decodeCurrentGopher(var t:xtText);
Var
  a,b,c,d:String;
  ab:array[0..1] of byte absolute a;
  ab0:byte absolute a;
  i,o,p:LongInt;

Function part:String;
Var i,o:LongInt;
Begin;
o:=666;
for i:=ab0 downto 1 do if (ab[i]=9) then o:=i;
part:=copy(a,1,o-1);
a:=copy(a,o+1,666);
End;

Begin;
outputAddLink('/','root');outputWriteBuf;
outputAddLink('../','parent');outputWriteBuf;
while not xtEOF(t) do begin;
  a:=xtReadLn(t,666);
  if (ab0=0) then continue;
  p:=ab[1];
  b:=copy(part,2,666);
  c:=part;
  d:=part;
  o:=BVal(part);
  if (d='') then begin;
    outputAddText(b);
    outputWriteBuf;
    continue;
    end;
  if (o<>70) then d:=d+':'+BStr(o);
  case p of
    $30:a:='text';
    $31:a:='menu';
    $32:a:='csopb';
    $33:a:='error';
    $34:a:='binhex';
    $35:a:='dos';
    $36:a:='uuenc';
    $37:a:='search';
    $38:a:='telnet';
    $39:a:='binary';
    $2b:a:='duplicate';
    $67:a:='gif';
    $49:a:='image';
    $54:a:='tn3270';
    else a:='$'+byte2hextype(p);
    end;
  outputAddText(a+':');
  outputAddLink('gopher://'+d+'/'+c,b);
  outputWriteBuf;
  end;
End;
